<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GYM PRO - Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    body {
      margin: 0;
      background-color: #f8f9fc;
      display: flex;
      min-height: 100vh;
    }
    aside {
      width: 240px;
      background-color: #1e2a78;
      color: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    aside h1 {
      font-size: 22px;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    aside nav a {
      color: #cbd5e1;
      margin: 12px 0;
      text-decoration: none;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    aside nav a:hover, aside nav a.active {
      color: white;
    }
    main {
      flex: 1;
      padding: 30px;
    }
    .dashboard {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
    }
    .card {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .card h4 {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 5px;
    }
    .card p {
      font-size: 24px;
      font-weight: bold;
    }
    .recent-activity, .membership-chart {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      flex: 1;
    }
    .recent-activity ul {
      list-style: none;
      padding: 0;
    }
    .recent-activity li {
      margin-bottom: 10px;
      font-size: 14px;
    }
    .chart-row {
      display: flex;
      gap: 20px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .top-bar .admin {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    canvas {
      max-width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    table th, table td {
      padding: 8px;
      border-bottom: 1px solid #e5e7eb;
    }
    .distribution-chart {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <aside>
    <div>
      <h1>üèãÔ∏è‚Äç‚ôÇÔ∏è GYM PRO</h1>
      <nav>
        <a class="active" href="#">üìä Dashboard</a>
        <a href="#">üë• Miembros</a>
        <a href="#">üí≥ Membres√≠as</a>
        <a href="#">üìÖ Asistencia</a>
        <a href="#">üìÑ Reportes</a>
        <a href="#">‚öôÔ∏è Configuraci√≥n</a>
      </nav>
    </div>
    <div>
      <p>Soporte 24/7<br><a href="mailto:contacto@gympro.com" style="color:#60a5fa;">contacto@gympro.com</a></p>
    </div>
  </aside>

  <main>
    <div class="top-bar">
      <h2>Panel de Control</h2>
      <div class="admin">
        <span>Admin</span>
        <img src="https://i.pravatar.cc/32" style="border-radius: 50%;" alt="Admin" />
      </div>
    </div>

    <div class="dashboard">
      <div class="stats">
        <div class="card">
          <h4>Miembros Activos</h4>
          <p id="total-activos">0</p>
        </div>
        <div class="card">
          <h4>Membres√≠as Activas</h4>
          <p id="nuevos-usuarios">0</p>
        </div>
        <div class="card">
          <h4>Por Vencer</h4>
          <p>24</p>
        </div>
        <div class="card">
          <h4>Ingresos Mensuales</h4>
          <p>$12,480</p>
        </div>
      </div>

      <div class="chart-row">
        <div class="recent-activity">
          <h4>Actividad Reciente</h4>
          <ul id="actividad-reciente"></ul>
        </div>
        <div class="membership-chart">
          <h4>√öltimos Miembros</h4>
          <table>
            <thead><tr><th>Nombre</th><th>Hasta</th></tr></thead>
            <tbody id="ultimos-miembros"></tbody>
          </table>
        </div>
      </div>

      <div class="distribution-chart">
        <h4>Distribuci√≥n de Membres√≠as</h4>
        <canvas id="graficaMembresias"></canvas>
      </div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, getDocs, query, orderBy, limit
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "gymrats-d16eb.firebaseapp.com",
      projectId: "gymrats-d16eb",
      storageBucket: "gymrats-d16eb.appspot.com",
      messagingSenderId: "106526343668278361492",
      appId: "1:106526343668278361492:web:abcd1234efgh5678"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const totalActivos = document.getElementById('total-activos');
    const nuevosUsuarios = document.getElementById('nuevos-usuarios');
    const ultimosMiembros = document.getElementById('ultimos-miembros');
    const actividadReciente = document.getElementById('actividad-reciente');

    let conteoTipos = { Basica: 0, Estandar: 0, Premium: 0, VIP: 0 };

    async function cargarUsuarios() {
      ultimosMiembros.innerHTML = "";
      actividadReciente.innerHTML = "";
      let activos = 0;
      let nuevos = 0;
      const hoy = new Date();

      try {
        const q = query(collection(db, "usuarios"), orderBy("Creado", "desc"), limit(50));
        const snapshot = await getDocs(q);

        snapshot.forEach((doc) => {
          const data = doc.data();
          const fecha = data.SuscripcionHasta.toDate();
          const vencimientoStr = fecha.toISOString().split("T")[0];
          const tipo = data.Tipo || "Basica";
          conteoTipos[tipo] = (conteoTipos[tipo] || 0) + 1;

          if (nuevos < 5) {
            ultimosMiembros.innerHTML += `<tr><td>${data.Nombre}</td><td>${vencimientoStr}</td></tr>`;
            actividadReciente.innerHTML += `<li><strong>${data.Nombre}</strong> se suscribi√≥ hasta ${vencimientoStr}</li>`;
          }

          if (fecha >= hoy) activos++;
          nuevos++;
        });

        totalActivos.textContent = activos;
        nuevosUsuarios.textContent = nuevos;

        renderChart();
      } catch (err) {
        console.error("Error al cargar usuarios:", err);
      }
    }

    function renderChart() {
      const ctx = document.getElementById('graficaMembresias').getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['B√°sica', 'Est√°ndar', 'Premium', 'VIP'],
          datasets: [{
            data: [conteoTipos.Basica, conteoTipos.Estandar, conteoTipos.Premium, conteoTipos.VIP],
            backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'],
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'right'
            }
          }
        }
      });
    }

    cargarUsuarios();
  </script>
</body>
</html>